good<-complete.cases(x,y)
good
x[good]
y[good]
load("F:/Plovers/3rd Chapter/input/Madagascar/.RData")
bfa[is.na(bfa$parent),]
table(sex$sex, na.omit=F)
help(table)
table(sex$sex, useNA=]"always")
table(sex$sex, useNA="always")
sex<-sex[!is.na(sex$sex),]
bfa$mol_sex.p1<-NA
bfa$mol_sex.p2<-NA
#a) add mol sex to individuals with rings FH...
letters<-"^[FH0-9]*$"
for(i in 1:length(bfa$year)){ #modification for MAD, search for rings of individuals with code but no ring
print(i)
if(!is.na(bfa$parent1[i]) & grepl(pattern=letters, bfa$parent1[i], perl=T)){
bfa$mol_sex.p1[i] <- sex$sex[match(bfa$parent1[i], sex$ring)]
}
if(!is.na(bfa$parent2[i]) & grepl(pattern=letters, bfa$parent2[i], perl=T)){
bfa$mol_sex.p2[i] <- sex$sex[match(bfa$parent2[i], sex$ring)]
}
}
#b) add mol sex to individuals with no rings
bfa$sp.new.code.p1 <- paste(bfa$species, bfa$new.code.p1, sep="-")
bfa$sp.new.code.p2 <- paste(bfa$species, bfa$new.code.p2, sep="-")
sex$sp.code <- paste(sex$species, sex$ring, sep="-")
for(i in 1:length(bfa$year)){ #modification for MAD, search for rings of individuals with code but no ring
if(is.na(bfa$mol_sex.p1[i]) & !is.na(bfa$new.code.p1[i])){
bfa$mol_sex.p1[i] <- sex$sex[match(bfa$sp.new.code.p1[i], sex$sp.code)]
print(i)
}
if(is.na(bfa$mol_sex.p2[i]) & !is.na(bfa$new.code.p2[i])){
bfa$mol_sex.p2[i] <- sex$sex[match(bfa$sp.new.code.p2[i], sex$sp.code)]
}
}
#---debug 2.--------------------------------------------------------
head(bfa)
str(bfa[is.na(bfa$mol_sex.p1),]) #372 NAs in mol_sex.p1, after sp.code (b) 328 NAs
str(bfa[is.na(bfa$mol_sex.p2),]) #822 NAs in mol_sex.p2, after sp.code (b) 815 NAs
str(bfa[is.na(bfa$mol_sex.p2) & is.na(bfa$mol_sex.p1),]) #334 NAs in both molp1 and molp2, after sp.code (b) 290 NAs
#--------------------------------------------------
#3. Create parent column
#Both parents are present
for(i in 1:length(bfa$year)){
if(!is.na(bfa$parent1[i]) & !is.na(bfa$parent2[i])|
!is.na(bfa$mol_sex.p1[i]) & !is.na(bfa$mol_sex.p2[i])){
bfa$parent[i] <- 4
}
}
bfa[bfa$parent %in% "4",]
bfa[!bfa$parent %in% "4",]
table(bfa$mol_sex.p1)
table(bfa$mol_sex.p2)
#One parent present
for(i in 1:length(bfa$year)){
print(i)
if(!is.na(bfa$mol_sex.p1[i]) & is.na(bfa$mol_sex.p2[i])){
if(bfa$mol_sex.p1[i] %in% "M"){
bfa$parent[i] <- 3
}else{
if(bfa$mol_sex.p1[i] %in% "F"){
bfa$parent[i] <- 2
}
}
}else{
if(!is.na(bfa$mol_sex.p2[i]) & is.na(bfa$mol_sex.p1[i])){
if(bfa$mol_sex.p2[i] %in% "M"){
bfa$parent[i] <- 3
}else{
if(bfa$mol_sex.p2[i] %in% "F"){
bfa$parent[i] <- 2
}
}
}
}
}
str(bfa[is.na(bfa$mol_sex.p1),]) #372 NAs in mol_sex.p1, after sp.code (b) 328 NAs
str(bfa[is.na(bfa$mol_sex.p2),]) #822 NAs in mol_sex.p2, after sp.code (b) 815 NAs
str(bfa[is.na(bfa$mol_sex.p2) & is.na(bfa$mol_sex.p1),]) #334 NAs in both molp1 and molp2, after sp.code (b) 290 NAs
for(i in 1:length(bfa$year)){
if(!is.na(bfa$parent1[i]) & !is.na(bfa$parent2[i])|
!is.na(bfa$mol_sex.p1[i]) & !is.na(bfa$mol_sex.p2[i])){
bfa$parent[i] <- 4
}
}
bfa[bfa$parent %in% "4",]
bfa[!bfa$parent %in% "4",]
table(bfa$mol_sex.p1)
table(bfa$mol_sex.p2)
#One parent present
for(i in 1:length(bfa$year)){
print(i)
if(!is.na(bfa$mol_sex.p1[i]) & is.na(bfa$mol_sex.p2[i])){
if(bfa$mol_sex.p1[i] %in% "M"){
bfa$parent[i] <- 3
}else{
if(bfa$mol_sex.p1[i] %in% "F"){
bfa$parent[i] <- 2
}
}
}else{
if(!is.na(bfa$mol_sex.p2[i]) & is.na(bfa$mol_sex.p1[i])){
if(bfa$mol_sex.p2[i] %in% "M"){
bfa$parent[i] <- 3
}else{
if(bfa$mol_sex.p2[i] %in% "F"){
bfa$parent[i] <- 2
}
}
}
}
}
#---------------------debug
bfa[is.na(bfa$parent1) & !is.na(bfa$parent2),]
head(bfa)
table(bfa$year)
bfa[is.na(bfa$parent),]
table(bfa$parents, useNA="always")
table(bfa$parent, useNA="always")
bfa[is.na(bfa$parent),c("parent1","parent2","mol_sex.p1", "mol_sex.p2", "parent")]
bfa[is.na(bfa$parent),c("parent1","parent2","new.code1","mol_sex.p1", "mol_sex.p2", "parent")]
head(bfa)
bfa[is.na(bfa$parent),c("parent1","parent2","new.code.p1","new.code.p2","mol_sex.p1", "mol_sex.p2", "parent")]
#--------------------------
bfa[is.na(bfa$parent),c("parent1","parent2","new.code.p1","new.code.p2","mol_sex.p1", "mol_sex.p2", "parent")]
head(bfa)
bfa$no_chicks <- apply(bfa[,c("chick1","chick2","chick3")], 1 function(x)
length (which(!is.na(x))))
bfa$no_chicks <- apply(bfa[,c("chick1","chick2","chick3")], 1 function(x)
length
bfa$no_chicks <- apply(bfa[,c("chick1","chick2","chick3")], 1 function(x) length(which(!is.na(x))))
#----------------------WRITE STD FILE
bfa$no_chicks <- apply(bfa[,c("chick1","chick2","chick3")], 1 function(x) length(which(!is.na(x))))
bfa$no_chicks <- apply(bfa[,c("chick1","chick2","chick3")], 1, function(x) length(which(!is.na(x))))
bfa$no_chicks
head(bfa)
setwd("F:/Plovers/3rd Chapter/Exploratory_results/input")
csvfiles <- list.files(path = ".", pattern='*\\.csv$', all.files=TRUE)
csvfiles
import.list <- lapply(csvfiles, read.csv, header = TRUE, as.is=TRUE, na.strings=c("NA"," ",""))
working.list <- import.list[3]
names(working.list) <- c("both")
attach(working.list)
#detach(working.list)
#--------------------------------------------------------------
both0<-both
both<-both0
names(both)
head(both)
str(both)#5143 obs
#--------function to convert dates to juliandates:---------------
datetojulian=function(x,year)    #x has to be a date in the date format %d-%m-%Y
{
origin<-as.Date(paste(year,'-01-01', sep=""))
juliandate<-(x-origin)+1
}
#-------------------------------------------------
#omit next part, Ceuta's file was modified to include this already
#0. Prepare data, Ceuta needs re-naming variables first.res.bs and last.res.bs-----
#
# both[both$population %in% "Ceuta",c("first.res.bs", "first.res","first.d.seen")]
#
# ind<-which(both$population %in% "Ceuta" & both$first.res.bs != both$first.res)
# both[ind,c("first.res.bs", "first.res","first.d.seen")]
#
# both[both$population %in% "Ceuta",c("last.res.bs", "last.res")]
#
# both$first.res[both$population%in%"Ceuta"]<-both$first.res.bs[both$population%in% "Ceuta"]
# both$last.res[both$population %in% "Ceuta"] <- both$last.res.bs[both$population%in%"Ceuta"]
#
# str(both)
# names(both)
# cols <- c(26,27,30,31,55,56)
# both[,cols]<-lapply(both[,cols], as.Date, "%d/%m/%Y") #change columns to dates
#
# str(both[,c("first.res", "last.res","first.cap.r","last.cap.r","first.bf.adult.r", "last.bf.adult.r")])
#
# both$first.d.seen2 <- apply(both[,c("first.res", "last.res","first.cap.r","last.cap.r","first.bf.adult.r", "last.bf.adult.r")],1,function (x) min(x, na.rm=T))
#
# both$last.d.seen2 <- apply(both[,c("first.res", "last.res","first.cap.r","last.cap.r","first.bf.adult.r", "last.bf.adult.r")],1,function (x) max(x, na.rm=T))
#
# both[, c("first.d.seen","first.d.seen2")]
# head(both)
# tail(both)
#---------------------------------------------------
#1. Change data structure-------------
#Each row should be one individual with all it's breeding events per year
both$ring[both$population %in% "Ceuta"] %in% both$ring[both$population %in% "Maio"] #non of the rings in Ceuta are in Maio ,/
both$year.ring <- ifelse(is.na(both$ring) & !is.na(both$code), paste(both$year, both$code, sep="-"), paste(both$year, both$ring, sep="-"))
both$pop.sp <- paste(both$population, both$species, sep="-")
both$nest.id <- paste(both$pop.sp, both$year, both$site, both$nest, sep="-")
head(both[order(both$year.ring),])
both$last.d.seen <- as.Date(both$last.d.seen, "%d/%m/%Y")
both$first.d.seen <- as.Date(both$first.d.seen, "%d/%m/%Y")
both$layingdate <- as.Date(both$layingdate, "%d/%m/%Y")
both$found_date.r <- as.Date(both$found_date.r, "%d/%m/%Y")
both$end_date.r <- as.Date(both$end_date.r, "%d/%m/%Y")
both$ld.minus10<-both$layingdate-10
str(both, list.len=500)
#Restrict dataset to omit cases with no layingdate nor found_date---------
both1<-both[!is.na(both$layingdate) | !is.na(both$found_date.r), ] #102 obs that need to be omitted
str(both1) #5041 ,/ correct number of observations omitting 102 obs with no laying date nor founddate
#And delete duplicated nests:
#------------------------------------------------
#1.a) Variables relevant to all nests: clutch_size and no_chicks
both1$clutch_size1<-NA
both1$clutch_size2<-NA
both1$clutch_size3<-NA
both1$clutch_size4<-NA
both1$fate1<-NA
both1$fate2<-NA
both1$fate3<-NA
both1$fate4<-NA
both1$no_chicks1<-NA
both1$no_chicks2<-NA
both1$no_chicks3<-NA
both1$no_chicks4<-NA
#1.a.i) Use layingdate to order all breeding events of individuals:
both1$jd.idate<- ifelse(!is.na(both1$layingdate), datetojulian(both1$layingdate, both1$year), datetojulian(both1$found_date.r, both1$year)) #julian date of initial date of a nest (using either laying_date or found_date)
#-----------------
i<-which(both1$year.ring %in% "1999-4497")
i<-1
for(i in 1:length(both1$year)){  #for loop brood fates adults
print(i)
#options(warn=1)
options(warn=0)
ind <- which(both1$year.ring[i] == both1$year.ring)
group.nests<-both1[ind,]
group.nests<-group.nests[order(group.nests$jd.idate),]
both1$total.nests.peryear[i] <- length(group.nests$year)
if(length(group.nests$year)==1){
both1$ordinal.nest.peryear[i]<-1
both1$clutch_size1[i]<-group.nests$clutch_size[1]
both1$no_chicks1[i]<-group.nests$no_chicks[1]
both1$fate1[i]<-group.nests$fate[1]
both1$earliest.seen[i] <- min(group.nests$first.d.seen, na.rm=T)
both1$latest.seen[i] <- max(group.nests$last.d.seen, na.rm=T)
both1$min.ldminus10[i] <- min(group.nests$ld.minus10, na.rm=T)
both1$earliest.founddate[i] <- min(group.nests$found_date.r, na.rm=T)
both1$latest.enddate[i] <- max(group.nests$end_date.r, na.rm=T)
both1$min.layingdate[i] <- min(group.nests$layingdate, na.rm=T)
}else{
if(length(group.nests$year)==2){
both1$ordinal.nest.peryear[i]<-ifelse(both1$nest.id[i] %in% group.nests$nest.id[1],1,2)
both1$clutch_size1[i]<-group.nests$clutch_size[1]
both1$clutch_size2[i]<-group.nests$clutch_size[2]
both1$no_chicks1[i]<-group.nests$no_chicks[1]
both1$no_chicks2[i]<-group.nests$no_chicks[2]
both1$fate1[i]<-group.nests$fate[1]
both1$fate2[i]<-group.nests$fate[2]
both1$earliest.seen[i] <- min(group.nests$first.d.seen, na.rm=T)
both1$latest.seen[i] <- max(group.nests$last.d.seen, na.rm=T)
both1$min.ldminus10[i] <- min(group.nests$ld.minus10, na.rm=T)
both1$earliest.founddate[i] <- min(group.nests$found_date.r, na.rm=T)
both1$latest.enddate[i] <- max(group.nests$end_date.r, na.rm=T)
both1$min.layingdate[i] <- min(group.nests$layingdate, na.rm=T)
}else{
if(length(group.nests$year)==3){
both1$ordinal.nest.peryear[i]<-ifelse(both1$nest.id[i] %in% group.nests$nest.id[1], 1,
ifelse(both1$nest.id[i]%in%group.nests$nest.id[2],2,3))
both1$clutch_size1[i]<-group.nests$clutch_size[1]
both1$clutch_size2[i]<-group.nests$clutch_size[2]
both1$clutch_size3[i]<-group.nests$clutch_size[3]
both1$no_chicks1[i]<-group.nests$no_chicks[1]
both1$no_chicks2[i]<-group.nests$no_chicks[2]
both1$no_chicks3[i]<-group.nests$no_chicks[3]
both1$fate1[i]<-group.nests$fate[1]
both1$fate2[i]<-group.nests$fate[2]
both1$fate3[i]<-group.nests$fate[3]
both1$earliest.seen[i] <- min(group.nests$first.d.seen, na.rm=T)
both1$latest.seen[i] <- max(group.nests$last.d.seen, na.rm=T)
both1$min.ldminus10[i] <- min(group.nests$ld.minus10, na.rm=T)
both1$earliest.founddate[i] <- min(group.nests$found_date.r, na.rm=T)
both1$latest.enddate[i] <- max(group.nests$end_date.r, na.rm=T)
both1$min.layingdate[i] <- min(group.nests$layingdate, na.rm=T)
}else{
if(length(group.nests$year)==4){
both1$ordinal.nest.peryear[i]<-ifelse(both1$nest.id[i] %in% group.nests$nest.id[1], 1,
ifelse(both1$nest.id[i]%in%group.nests$nest.id[2],2,
ifelse(both1$nest.id[i]%in%group.nests$nest.id[3],3,4)))
both1$clutch_size1[i]<-group.nests$clutch_size[1]
both1$clutch_size2[i]<-group.nests$clutch_size[2]
both1$clutch_size3[i]<-group.nests$clutch_size[3]
both1$clutch_size4[i]<-group.nests$clutch_size[4]
both1$no_chicks1[i]<-group.nests$no_chicks[1]
both1$no_chicks2[i]<-group.nests$no_chicks[2]
both1$no_chicks3[i]<-group.nests$no_chicks[3]
both1$no_chicks4[i]<-group.nests$no_chicks[4]
both1$fate1[i]<-group.nests$fate[1]
both1$fate2[i]<-group.nests$fate[2]
both1$fate3[i]<-group.nests$fate[3]
both1$fate4[i]<-group.nests$fate[4]
both1$earliest.seen[i] <- min(group.nests$first.d.seen, na.rm=T)
both1$latest.seen[i] <- max(group.nests$last.d.seen, na.rm=T)
both1$min.ldminus10[i] <- min(group.nests$ld.minus10, na.rm=T)
both1$earliest.founddate[i] <- min(group.nests$found_date.r, na.rm=T)
both1$latest.enddate[i] <- max(group.nests$end_date.r, na.rm=T)
both1$min.layingdate[i] <- min(group.nests$layingdate, na.rm=T)
}
}
}
}
}
#----------------------------------------------
#Easier to extract earliest and latest date per individual per year...
#Use similar for loop used to extract brood fate dates in extract_breedingschedule.R:
#
#
# for(i in 1:length(both$year)){  #for loop brood fates adults
#   print(i)
#   #options(warn=1)
#   options(warn=0)
#   ind <- which(both$year.ring[i] == both$year.ring)
#   group.nests<-both[ind,]
#
#   #both$total.nests.peryear[i] <- length(group.nests$year)
#   both$earliest.seen[i] <- min(group.nests$first.d.seen2, na.rm=T)
#   both$latest.seen[i] <- max(group.nests$last.d.seen2, na.rm=T)
#   both$min.ldminus10[i] <- min(group.nests$ld.minus10, na.rm=T)
#   both$earliest.founddate[i] <- min(group.nests$found_date.r, na.rm=T)
#   both$latest.enddate[i] <- max(group.nests$end_date.r, na.rm=T)
#   both$min.layingdate[i] <- min(group.nests$layingdate, na.rm=T)
# }
#change to dates:
both2<-both1
names(both2)
cols <- c(115:120)
both2[,cols]<-lapply(both2[,cols], as.Date, origin="1970-01-01") #change columns to dates
str(both2, list.len = 999)
str(both, list.len = 999)
#-----------debug------
unique(both1$year.ring) #4465 nests with ordinal.nest.peryear ==1 should be equal to this number:
un.ids<-both2[both2$ordinal.nest.peryear==1,]
str(both2[both2$ordinal.nest.peryear==1,]) #4469....4 more...why? ,/ corrected
setdiff(unique(both1$year.ring), unique(un.ids$year.ring)) #SAME IDS....but there are some repeated?? Duplicated nests in file
ind<-which(duplicated(un.ids$year.ring)|duplicated(un.ids$year.ring, fromLast=T))
un.ids[ind,"nest.id"] #none after corrections
#some of the duplicated nests were duplicated because the mate's ring was equal to the focal's ring.
#Deleted duplicate ids by hand in file v3 15/04/2016
# [1] "Maio-KP-2008-S--16"   "Maio-KP-2008-S--18"   "Maio-KP-2010-S-66"    "Maio-KP-2008-S--16"   "Maio-KP-2008-S--18"   "Maio-KP-2010-S-66"    "Tuzla-KP-1996-B-1276"
# [8] "Tuzla-KP-1996-B-1276" (Deleted one)
head(both2[both2$ordinal.nest.peryear==1,])
ind<-sample(rownames(un.ids),10)
un.ids[ind,]
# tail(both2[order(both2$year.ring),])
#
# tail(both[order(both$year.ring) & both$total.nests.peryear>1,], n=-528)
#
# ind<-both$nest.id[both$total.nests.peryear>1]
#
# head(both[both$nest.id %in% ind,])
# both[both$ring %in% "802122903",]
#--------------------------------------------------------
#---------------------------------------------------------
#2. Calculate duration of breeding schedule----
#Definition of breeding schedule:
#     The overall time spent in the breeding area of each focal individual in a specific breeding season.
indiv<-un.ids
names(indiv)
str(indiv) #4465
#   2a. Start and end---------------------
i<-4429
for(i in 1:length(indiv$year.ring)){  #for loop brood fates adults
print(i)
options(warn=1)
bs.start.df <- indiv[i,c("earliest.seen","min.ldminus10","earliest.founddate")]
indiv$bs.start[i] <- apply(bs.start.df, 1, function(x) min(x, na.rm=T))
indiv$bs.start.which[i] <- colnames(bs.start.df)[apply(bs.start.df,1, function(x) which(x==min(x, na.rm=T)))]
bs.end.df <- indiv[i, c("latest.seen","latest.enddate","min.ldminus10","earliest.founddate")]
indiv$bs.end[i] <- apply(bs.end.df, 1, function(x) max(x, na.rm=T))
indiv$bs.end.which[i] <- colnames(bs.end.df)[apply(bs.end.df, 1, function(x) which(x==max(x, na.rm=T)))]
}
str(indiv)
#indiv$bs.start<-as.Date(indiv$bs.start, origin="1970-01-01")
#indiv$bs.end<-as.Date(indiv$bs.end, origin="1970-01-01")
indiv$bs.start<-as.Date(indiv$bs.start, "%Y-%m-%d")
indiv$bs.end<-as.Date(indiv$bs.end, "%Y-%m-%d")
#-------------develop 2a.-----------
head(indiv)
# as.Date(min(indiv$earliest.seen[1], indiv$min.ldminus10[1], indiv$earliest.founddate[1], na.rm=T), "%d/%m/%_Y")
#
# colnames(indiv[,c("earliest.seen","min.ldminus10","earliest.founddate")])[which.min(indiv[,c("earliest.seen","min.ldminus10","found_date.r")])]
#
# x<-indiv[1,c("earliest.seen","min.ldminus10","earliest.founddate")]
# min(indiv[1,c("earliest.seen","min.ldminus10","earliest.founddate")])
# apply(x, 1, min)
# str(x)
# str(bs.start.df)
#
# colnames(x)[apply(x, 1, function(x) which(x==min(x)))]
#----------debug 2a.-----
# library(date)
# indiv.chr<- indiv
# indiv.chr$min.ldminus10 <- as.character(indiv.chr$min.ldminus10)
# indiv.chr$earliest.seen <- as.character(indiv.chr$earliest.seen)
# indiv.chr$latest.seen <- as.character(indiv.chr$latest.seen)
# indiv.chr$nest <- as.numeric(indiv.chr$nest)
# indiv.chr$found_date.r <- as.character(indiv.chr$found_date.r)
#
# str(indiv.chr)
#
# indiv.chr[is.na(indiv.chr$min.ldminus10),]
# indiv.chr[is.na(indiv.chr$earliest.seen),] #mainly nests that disappeared
# indiv.chr[is.na(indiv.chr$latest.seen),]#mainly nests that disappeared
#
# indiv.chr[is.na(indiv.chr$found_date.r)& indiv.chr$nest>0,]#positive nests with no founddate...ignore the ones with no layingdate?
# str(indiv.chr[is.na(indiv.chr$found_date.r)& indiv.chr$nest>0,])#16 observations
#
#2015-CA3076 does not have any date
#both[both$year.ring %in% "2015-CA3076",]
#case indiv 785 has no date available
# indiv[785,] #2010-CA2656
# both[both$year.ring %in% "2010-CA2656",] #comments: Iwan's nest 2010-S-105/made appropriate changes in all my data (not std files)
# both[both$nest.id %in% "2010-S-24",]
#
#----------------------------------------------------------
#   2b. Duration------------------------
str(indiv)
indiv$bs.length <- as.numeric(indiv$bs.end - indiv$bs.start)
str(indiv[indiv$bs.length ==0,]) #seen once and layingdates not known, only bred once in a year = 8 obs
u1<-indiv[indiv$mol_sex_focal == indiv$mol_sex_mate & !is.na(indiv$year.ring),]
head(u1)
table(u1$population)
indiv$sex.reliable<-ifelse(indiv$year.ring %in% u1$year.ring, "conflicting sex", NA)
str(indiv[indiv$sex.reliable %in% "conflicting sex",]) #89 ,/
write.csv(indiv, "F:/Plovers/3rd Chapter/Exploratory_results/output/bs_data_per_indiv.csv")
setwd("F:/Plovers/3rd Chapter/Exploratory_results/output")
csvfiles <- list.files(path = ".", pattern='*\\.csv$', all.files=TRUE)
setwd("F:/Plovers/3rd Chapter/Exploratory_results/output")
csvfiles <- list.files(path = ".", pattern='*\\.csv$', all.files=TRUE)
csvfiles
import.list <- lapply(csvfiles, read.csv, header = TRUE, as.is=TRUE, na.strings=c("NA"," ",""))
working.list <- import.list[4]
names(working.list) <- c("indiv")
attach(working.list)
hist(indiv$bs.length)
hist(indiv$bs.length)
table(indiv$bs.length)
shapiro.test(indiv$bs.length)
qqplot(indiv$bs.length)
qqplot(indiv$bs.length)
qqnorm(indiv$bs.length)
qqline(indiv$bs.length,lty=2)
ks.test(indiv$bs.length)
ks.test(indiv$bs.length, pnorm)
names(indiv)
pairs(~ bs.start + bs.end + bs.length+total.nests.per.year + pop.sp, data=indiv, panel=panel.smooth)
attach(indiv)
pairs(~ bs.start + bs.end + bs.length+total.nests.per.year + pop.sp, panel=panel.smooth)
pairs(~ bs.start + bs.end + bs.length+total.nests.peryear + pop.sp, panel=panel.smooth)
pairs(~ bs.start + bs.end + bs.length+total.nests.peryear, panel=panel.smooth)
bs.start
bs.end
names(indiv)
indiv$pop.year <- paste(indiv$population, indiv$year, sep="-")
indiv<-ddply(indiv, c("pop.year"), transform, bs.start.std= scale(bs.start))
indiv<-ddply(indiv, c("pop.year"), transform, bs.end.std=scale(bs.end))
library(plyr)
indiv<-ddply(indiv, c("pop.year"), transform, bs.start.std= scale(bs.start))
indiv<-ddply(indiv, c("pop.year"), transform, bs.end.std=scale(bs.end))
indiv<-ddply(indiv, c("pop.year"), transform, bs.start.std= scale(bs.start))
indiv<-ddply(indiv, c("pop.year"), transform, bs.end.std=scale(bs.end))
str(indiv)
str(indiv, n=300)
help(str)
str(indiv, list.len=300)
names(indiv)
cols<-c(122,124)
str(indiv, list.len=300)
ind[,cols]<-apply(ind[,cols], 2, function(x) as.Date(x, "%Y-%m-%d"))
cols<-c(122,124)
indiv[,cols]<-apply(indiv[,cols], 2, function(x) as.Date(x, "%Y-%m-%d"))
indiv<-ddply(indiv, c("pop.year"), transform, bs.start.std= scale(bs.start))
indiv<-ddply(indiv, c("pop.year"), transform, bs.end.std=scale(bs.end))
pairs(~ bs.start.std + bs.end.std + bs.length+total.nests.peryear, panel=panel.smooth)
attach(indiv)
pairs(~ bs.start.std + bs.end.std + bs.length+total.nests.peryear, panel=panel.smooth)
indiv$pop.sp.sex<-ifelse(indiv$population %in% "Tuzla",
paste(indiv$population, indiv$species, indiv$field_sex_focal, sep="-"),
paste(indiv$population, indiv$species, indiv$mol_sex_focal, sep="-"))
indiv$pop.sp.field_sex<-paste(indiv$population, indiv$species, indiv$field_sex_focal, sep="-")
hist(indiv$bs.length~indiv$pop.sp.sex)
males.mol<-indiv[grep(indiv$pop.sp.sex, exp="M$"),]
males.mol<-indiv[grep(indiv$pop.sp.sex, pattern="M$"),]
males.mol$pop.sp.sex
females<-indiv[grep(indiv$pop.sp.sex, pattern="F$")]
females<-indiv[grep(indiv$pop.sp.sex, pattern="F$"),]
pairs(~ bs.start.std + bs.end.std + bs.length+total.nests.peryear, data=females, panel=panel.smooth)
pairs(~ bs.start.std + bs.end.std + bs.length+total.nests.peryear, data=males, panel=panel.smooth)
males.mol<-indiv[grep(indiv$pop.sp.sex, pattern="M$"),]
females.mol<-indiv[grep(indiv$pop.sp.sex, pattern="F$"),]
pairs(~ bs.start.std + bs.end.std + bs.length+total.nests.peryear, data=males.mol, panel=panel.smooth)
lm.1<-lm(bs.length~pop.sp.sex + bs.start.std, data=males.mol)
summary(lm.1)
lm.1<-lm(bs.length~pop.sp.sex + bs.start.std, data=indiv)
summary(lm.1)
lm.1<-lm(bs.length~pop.sp.sex + bs.start.std + total.nests.peryear, data=indiv)
summary(lm.1)
indiv$sex<-ifelse(indiv$population %in% "Tuzla", indiv$field_sex_focal, indiv$mol_sex_focal)
lm.1<-lm(bs.length~pop.sp + bs.start.std + total.nests.peryear + sex + pop.sp:sex, data=indiv)
summary(lm.1)
both<-rbind(males.mol, females.mol)
lm.1<-lm(bs.length~pop.sp + bs.start.std + total.nests.peryear + sex + pop.sp:sex, data=both)
males.mol<-indiv[grep(indiv$pop.sp.sex, pattern="M$"),]
females.mol<-indiv[grep(indiv$pop.sp.sex, pattern="F$"),]
both<-rbind(males.mol, females.mol)
lm.1<-lm(bs.length~pop.sp + bs.start.std + total.nests.peryear + sex + pop.sp:sex, data=both)
summary(lm.1)
lm.m<-lm(bs.length~pop.sp + bs.start.std + total.nests.peryear, data=males.mol)
summary(lm.m)
